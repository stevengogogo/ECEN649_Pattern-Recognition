<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.242">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ECEN649: Pattern Recognition - 10&nbsp; Homework4: Problem 6.12</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../hw/hw5.html" rel="next">
<link href="../hw/hw4.html" rel="prev">
<link href="../img/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Homework4: Problem 6.12</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">ECEN649: Pattern Recognition</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/stevengogogo/ECEN649_Pattern-Recognition" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true"><strong>Lecture Notes</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ch1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Chapter 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ch2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Chapter 2: Optimal Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ch3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chapter 3: Sampled-Based classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ch4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Chapter 4: Parametric Classification</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true"><strong>Assignments</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Homework 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Homework 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Homework 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Homework 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw4_p6-12_right_cv.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Homework4: Problem 6.12</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hw/hw5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Homework 5</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true"><strong>Final Project</strong></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../final_project.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Abstract</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../final_project/script/HMC_Copy_of_EXP_fit_time_window.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Predicting Stock Market with Bayesian Nerual Network</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../final_project/script/EXP_data_visualization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Dataset before COVID</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../final_project/script/jax_basic.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Introduction to Jax</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../final_project/script/jax_bnn.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Bayesian Neural Network with Jax</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ref.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#libraries" id="toc-libraries" class="nav-link active" data-scroll-target="#libraries"><span class="toc-section-number">10.0.1</span>  Libraries</a></li>
  <li><a href="#computational-environment" id="toc-computational-environment" class="nav-link" data-scroll-target="#computational-environment"><span class="toc-section-number">10.0.2</span>  Computational Environment</a></li>
  <li><a href="#helper-function" id="toc-helper-function" class="nav-link" data-scroll-target="#helper-function"><span class="toc-section-number">10.0.3</span>  Helper function</a></li>
  <li><a href="#data-inspectation" id="toc-data-inspectation" class="nav-link" data-scroll-target="#data-inspectation"><span class="toc-section-number">10.0.4</span>  Data inspectation</a></li>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing"><span class="toc-section-number">10.0.5</span>  Data Processing</a></li>
  <li><a href="#feature-extraction" id="toc-feature-extraction" class="nav-link" data-scroll-target="#feature-extraction"><span class="toc-section-number">10.0.6</span>  Feature Extraction</a></li>
  <li><a href="#svm" id="toc-svm" class="nav-link" data-scroll-target="#svm"><span class="toc-section-number">10.0.7</span>  SVM</a></li>
  <li><a href="#a" id="toc-a" class="nav-link" data-scroll-target="#a"><span class="toc-section-number">10.0.8</span>  (a)</a></li>
  <li><a href="#b" id="toc-b" class="nav-link" data-scroll-target="#b"><span class="toc-section-number">10.0.9</span>  (b)</a></li>
  <li><a href="#c" id="toc-c" class="nav-link" data-scroll-target="#c"><span class="toc-section-number">10.0.10</span>  (c)</a></li>
  <li><a href="#d" id="toc-d" class="nav-link" data-scroll-target="#d"><span class="toc-section-number">10.0.11</span>  (d)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Homework4: Problem 6.12</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="libraries" class="level3" data-number="10.0.1">
<h3 data-number="10.0.1" class="anchored" data-anchor-id="libraries"><span class="header-section-number">10.0.1</span> Libraries</h3>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> PIL</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> platform</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.notebook <span class="im">import</span> tqdm</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.multiclass <span class="im">import</span> OneVsOneClassifier</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> svm</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats <span class="im">as</span> st</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="computational-environment" class="level3" data-number="10.0.2">
<h3 data-number="10.0.2" class="anchored" data-anchor-id="computational-environment"><span class="header-section-number">10.0.2</span> Computational Environment</h3>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>physical_devices <span class="op">=</span> tf.config.list_physical_devices(<span class="st">'GPU'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>my_system <span class="op">=</span> platform.uname()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(physical_devices)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"System: </span><span class="sc">{</span>my_system<span class="sc">.</span>system<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Node Name: </span><span class="sc">{</span>my_system<span class="sc">.</span>node<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Release: </span><span class="sc">{</span>my_system<span class="sc">.</span>release<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Version: </span><span class="sc">{</span>my_system<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Machine: </span><span class="sc">{</span>my_system<span class="sc">.</span>machine<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Processor: </span><span class="sc">{</span>my_system<span class="sc">.</span>processor<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')]
System: Darwin
Node Name: client-10-229-179-166.tamulink.tamu.edu
Release: 21.5.0
Version: Darwin Kernel Version 21.5.0: Tue Apr 26 21:08:29 PDT 2022; root:xnu-8020.121.3~4/RELEASE_ARM64_T8101
Machine: arm64
Processor: i386</code></pre>
</div>
</div>
</section>
<section id="helper-function" class="level3" data-number="10.0.3">
<h3 data-number="10.0.3" class="anchored" data-anchor-id="helper-function"><span class="header-section-number">10.0.3</span> Helper function</h3>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_image(path, width<span class="op">=</span><span class="dv">484</span>, preprocess_input<span class="op">=</span>tf.keras.applications.vgg16.preprocess_input):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Load and Preprocessing image</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> tf.keras.utils.load_img(path)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> tf.keras.utils.img_to_array(img)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> x[<span class="dv">0</span>:width,:,:]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.expand_dims(x, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tf.keras.applications.vgg16.preprocess_input(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-inspectation" class="level3" data-number="10.0.4">
<h3 data-number="10.0.4" class="anchored" data-anchor-id="data-inspectation"><span class="header-section-number">10.0.4</span> Data inspectation</h3>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dpath <span class="op">=</span> os.path.join(<span class="st">"data"</span>, <span class="st">"CMU-UHCS_Dataset"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>pic_path <span class="op">=</span> os.path.join(dpath, <span class="st">"images"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df_micro <span class="op">=</span> pd.read_csv( os.path.join(dpath, <span class="st">"micrograph.csv"</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df_micro <span class="op">=</span> df_micro[[<span class="st">"path"</span>, <span class="st">"primary_microconstituent"</span>]]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(df_micro)):</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    img_ph <span class="op">=</span> os.path.join(pic_path,df_micro.iloc[i][<span class="dv">0</span>])</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> os.path.exists(img_ph)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    df_micro.iloc[i][<span class="dv">0</span>] <span class="op">=</span> img_ph</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>df_micro2 <span class="op">=</span> df_micro.copy()</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>CLS_rm <span class="op">=</span> [<span class="st">"pearlite+widmanstatten"</span>, <span class="st">"martensite"</span>, <span class="st">"pearlite+spheroidite"</span>] <span class="co">#(type, sample size)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> CLS_rm:</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    df_micro.drop(df_micro[df_micro[<span class="st">"primary_microconstituent"</span>] <span class="op">==</span> c].index, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># labels</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>name_lbs <span class="op">=</span> df_micro[<span class="st">"primary_microconstituent"</span>].unique()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> preprocessing.LabelEncoder()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>le.fit(name_lbs)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(le.classes_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>['network', 'pearlite', 'spheroidite', 'spheroidite+widmanstatten']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dlabel <span class="op">=</span> le.transform(df_micro[<span class="st">"primary_microconstituent"</span>])</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_micro.insert(<span class="dv">2</span>, <span class="st">"label"</span>, dlabel)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df_micro</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>path</th>
      <th>primary_microconstituent</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1.tif</td>
      <td>pearlite</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph2.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph5.tif</td>
      <td>pearlite</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph6.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph7.tif</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>955</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1722.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>957</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1726.tif</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>958</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1730.png</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>959</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1731.tif</td>
      <td>pearlite</td>
      <td>1</td>
    </tr>
    <tr>
      <th>960</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1732.tif</td>
      <td>pearlite</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>791 rows × 3 columns</p>
</div>
</div>
</div>
</section>
<section id="data-processing" class="level3" data-number="10.0.5">
<h3 data-number="10.0.5" class="anchored" data-anchor-id="data-processing"><span class="header-section-number">10.0.5</span> Data Processing</h3>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train-test split</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> df_micro.copy()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> df_micro.keys())</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>split_info <span class="op">=</span> [(<span class="st">"spheroidite"</span>, <span class="dv">100</span>),<span class="op">\</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>              (<span class="st">"network"</span>, <span class="dv">100</span>),<span class="op">\</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>              (<span class="st">"pearlite"</span>, <span class="dv">100</span>),<span class="op">\</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>              (<span class="st">"spheroidite+widmanstatten"</span>, <span class="dv">60</span>)] <span class="co">#(type, sample size)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ln <span class="kw">in</span> split_info:</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    label, n <span class="op">=</span> ln</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    id_train <span class="op">=</span> df_micro[df_micro[<span class="st">"primary_microconstituent"</span>] <span class="op">==</span> label][<span class="dv">0</span>:n].index</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    df_test.drop(id_train, axis<span class="op">=</span><span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    df_train <span class="op">=</span> pd.concat([df_train, df_micro.loc[id_train]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>path</th>
      <th>primary_microconstituent</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph2.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph6.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph10.png</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph11.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>20</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph29.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>596</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1093.tif</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>618</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1129.tif</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>631</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1156.tif</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>672</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1218.tif</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>673</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1219.tif</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>360 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>path</th>
      <th>primary_microconstituent</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>237</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph436.png</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>238</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph437.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>239</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph440.png</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>241</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph442.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>242</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph443.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>955</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1722.tif</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>957</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1726.tif</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>958</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1730.png</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>959</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1731.tif</td>
      <td>pearlite</td>
      <td>1</td>
    </tr>
    <tr>
      <th>960</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1732.tif</td>
      <td>pearlite</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>431 rows × 3 columns</p>
</div>
</div>
</div>
</section>
<section id="feature-extraction" class="level3" data-number="10.0.6">
<h3 data-number="10.0.6" class="anchored" data-anchor-id="feature-extraction"><span class="header-section-number">10.0.6</span> Feature Extraction</h3>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VGG16</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>base_model <span class="op">=</span> tf.keras.applications.vgg16.VGG16(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    include_top<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    weights<span class="op">=</span><span class="st">'imagenet'</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    input_tensor<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    input_shape<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    pooling<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    classes<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    classifier_activation<span class="op">=</span><span class="st">'softmax'</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>base_model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "vgg16"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 input_1 (InputLayer)        [(None, None, None, 3)]   0         
                                                                 
 block1_conv1 (Conv2D)       (None, None, None, 64)    1792      
                                                                 
 block1_conv2 (Conv2D)       (None, None, None, 64)    36928     
                                                                 
 block1_pool (MaxPooling2D)  (None, None, None, 64)    0         
                                                                 
 block2_conv1 (Conv2D)       (None, None, None, 128)   73856     
                                                                 
 block2_conv2 (Conv2D)       (None, None, None, 128)   147584    
                                                                 
 block2_pool (MaxPooling2D)  (None, None, None, 128)   0         
                                                                 
 block3_conv1 (Conv2D)       (None, None, None, 256)   295168    
                                                                 
 block3_conv2 (Conv2D)       (None, None, None, 256)   590080    
                                                                 
 block3_conv3 (Conv2D)       (None, None, None, 256)   590080    
                                                                 
 block3_pool (MaxPooling2D)  (None, None, None, 256)   0         
                                                                 
 block4_conv1 (Conv2D)       (None, None, None, 512)   1180160   
                                                                 
 block4_conv2 (Conv2D)       (None, None, None, 512)   2359808   
                                                                 
 block4_conv3 (Conv2D)       (None, None, None, 512)   2359808   
                                                                 
 block4_pool (MaxPooling2D)  (None, None, None, 512)   0         
                                                                 
 block5_conv1 (Conv2D)       (None, None, None, 512)   2359808   
                                                                 
 block5_conv2 (Conv2D)       (None, None, None, 512)   2359808   
                                                                 
 block5_conv3 (Conv2D)       (None, None, None, 512)   2359808   
                                                                 
 block5_pool (MaxPooling2D)  (None, None, None, 512)   0         
                                                                 
=================================================================
Total params: 14,714,688
Trainable params: 14,714,688
Non-trainable params: 0
_________________________________________________________________</code></pre>
</div>
</div>
<p>Use five layers</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>out_layer_ns <span class="op">=</span> [<span class="st">"block</span><span class="sc">{}</span><span class="st">_pool"</span>.<span class="bu">format</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>)]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>out_layer_ns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>['block1_pool', 'block2_pool', 'block3_pool', 'block4_pool', 'block5_pool']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct 5 models for feature extraction</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>extmodel <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(out_layer_ns, [tf.keras.Model(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    inputs<span class="op">=</span> base_model.<span class="bu">input</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    outputs<span class="op">=</span>base_model.get_layer(bk_name).output</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>) <span class="cf">for</span> bk_name <span class="kw">in</span> out_layer_ns]))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>extmodel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>{'block1_pool': &lt;keras.engine.functional.Functional at 0x2a7861070&gt;,
 'block2_pool': &lt;keras.engine.functional.Functional at 0x16f7c2070&gt;,
 'block3_pool': &lt;keras.engine.functional.Functional at 0x2a785cd90&gt;,
 'block4_pool': &lt;keras.engine.functional.Functional at 0x2a7855280&gt;,
 'block5_pool': &lt;keras.engine.functional.Functional at 0x2a7847190&gt;}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display output dimensions</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>out_shapes <span class="op">=</span> [extmodel[m].output_shape[<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> m <span class="kw">in</span> extmodel.keys()]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>out_shapes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>[64, 128, 256, 512, 512]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initiate feature maps for testing and training</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fs_train <span class="op">=</span> [np.zeros((df_train.shape[<span class="dv">0</span>], n_f)) <span class="cf">for</span> n_f <span class="kw">in</span> out_shapes]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>fs_test <span class="op">=</span> [np.zeros((df_test.shape[<span class="dv">0</span>], n_f)) <span class="cf">for</span> n_f <span class="kw">in</span> out_shapes]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>features_train <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(out_layer_ns, fs_train))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>features_test <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(out_layer_ns, fs_test))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>features_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>{'block1_pool': array([[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]]),
 'block2_pool': array([[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]]),
 'block3_pool': array([[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]]),
 'block4_pool': array([[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]]),
 'block5_pool': array([[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]])}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature extraction with VGG16</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#save file</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span>  <span class="bu">dict</span>(<span class="bu">zip</span>([<span class="st">"train"</span>, <span class="st">"test"</span>],<span class="op">\</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    [os.path.join(dpath, <span class="st">"feature_</span><span class="sc">{}</span><span class="st">.pkl"</span>.<span class="bu">format</span>(n))<span class="op">\</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> n <span class="kw">in</span> [<span class="st">"train"</span>, <span class="st">"test"</span>]]))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#if os.path.exists(os.path.join(dpath, "feature_train.pkl")) == False:</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> m <span class="kw">in</span> tqdm(extmodel.keys()):</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, df <span class="kw">in</span> <span class="bu">enumerate</span>([df_train, df_test]):</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, ph <span class="kw">in</span> tqdm(<span class="bu">enumerate</span>(df[<span class="st">"path"</span>])):</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> load_image(ph)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>            xb <span class="op">=</span> extmodel[m].predict(x, verbose <span class="op">=</span> <span class="dv">0</span>) <span class="co"># silence output</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>            F <span class="op">=</span> np.mean(xb,axis<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Save features</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                features_train[m][j, :] <span class="op">=</span> F</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                features_test[m][j, :] <span class="op">=</span> F</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">## Create new files</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>f_train <span class="op">=</span> <span class="bu">open</span>(paths[<span class="st">"train"</span>], <span class="st">"wb"</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>f_test <span class="op">=</span> <span class="bu">open</span>(paths[<span class="st">"test"</span>], <span class="st">"wb"</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co">## Write</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>pickle.dump(features_train, f_train)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>pickle.dump(features_test, f_test)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co">## Close files</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>f_train.close()</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>f_test.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"81865a1914b748c58017241ff8a1bf22","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"61ba0c730f454e93825bfef68abbbf81","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2732c0eda9f64a468700e153f153cc8c","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8ec758b4bc69476eb1cb266c63ee0bbd","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8d51dcff62c3493a91d39c87afb66872","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"940f2d56be6b483d9d808af5628d3056","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ab3eb8c0bbc54ef8902b180687cad120","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"aa90a1d368f2460c8aa9b1763a88519e","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a44c4b53ecdb459db4b201d54989be4f","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"32feae325651496387e34fdb2370c174","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d8b847d6b54b472591003f51a7401728","version_major":2,"version_minor":0}
</script>
</div>
</div>
</section>
<section id="svm" class="level3" data-number="10.0.7">
<h3 data-number="10.0.7" class="anchored" data-anchor-id="svm"><span class="header-section-number">10.0.7</span> SVM</h3>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ftn <span class="op">=</span> <span class="bu">open</span>(paths[<span class="st">"train"</span>], <span class="st">"rb"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ftt <span class="op">=</span> <span class="bu">open</span>(paths[<span class="st">"test"</span>], <span class="st">"rb"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>featn <span class="op">=</span> pickle.load(ftn) <span class="co"># train feature</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>featt <span class="op">=</span> pickle.load(ftt) <span class="co"># test feature</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ftn.close()</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>ftt.close()</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># label</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>ltrain <span class="op">=</span> df_train[[<span class="st">"primary_microconstituent"</span>, <span class="st">"label"</span>]].reset_index()</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>ltest <span class="op">=</span> df_test[[<span class="st">"primary_microconstituent"</span>, <span class="st">"label"</span>]].reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ltrain</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>index</th>
      <th>primary_microconstituent</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>20</td>
      <td>spheroidite</td>
      <td>2</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>355</th>
      <td>596</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>356</th>
      <td>618</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>357</th>
      <td>631</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>358</th>
      <td>672</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
    <tr>
      <th>359</th>
      <td>673</td>
      <td>spheroidite+widmanstatten</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>360 rows × 3 columns</p>
</div>
</div>
</div>
<section id="one-to-one-svm" class="level4" data-number="10.0.7.1">
<h4 data-number="10.0.7.1" class="anchored" data-anchor-id="one-to-one-svm"><span class="header-section-number">10.0.7.1</span> One-to-One SVM</h4>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> One2OneSVM:</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n_class<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_class <span class="op">=</span> n_class</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.clfs_list <span class="op">=</span> [svm.SVC(kernel<span class="op">=</span><span class="st">"rbf"</span>, C<span class="op">=</span><span class="fl">1.</span>, gamma<span class="op">=</span><span class="st">"auto"</span>)<span class="op">\</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="va">self</span>.n_class<span class="op">*</span><span class="va">self</span>.n_class)]</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.clfs <span class="op">=</span> [[<span class="va">self</span>.clfs_list[<span class="va">self</span>.n_class<span class="op">*</span>i <span class="op">+</span> j]<span class="op">\</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="va">self</span>.n_class)]<span class="op">\</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="va">self</span>.n_class)]</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cv <span class="op">=</span> np.zeros((<span class="va">self</span>.n_class,<span class="va">self</span>.n_class))</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> train(<span class="va">self</span>, ltrain, feature, fold<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># traversal all features</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="va">self</span>.n_class<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>            lis <span class="op">=</span> ltrain[ltrain[<span class="st">"label"</span>] <span class="op">==</span> i].index.to_numpy()</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i<span class="op">+</span><span class="dv">1</span>, <span class="va">self</span>.n_class):</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>                ljs <span class="op">=</span> ltrain[ltrain[<span class="st">"label"</span>] <span class="op">==</span> j].index.to_numpy()</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Data</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>                X <span class="op">=</span> np.concatenate(<span class="op">\</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>                  (feature[lis,:],<span class="op">\</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>                   feature[ljs,:]), axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>                Y <span class="op">=</span> np.concatenate((np.ones(<span class="bu">len</span>(lis))<span class="op">*</span>i,np.ones(<span class="bu">len</span>(ljs))<span class="op">*</span>j))</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Train SVM</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>                scores <span class="op">=</span> sklearn.model_selection.cross_val_score<span class="op">\</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>                        (<span class="va">self</span>.clfs[i][j], X, Y, cv<span class="op">=</span>fold)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.clfs[i][j].fit(X,Y)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.cv[i][j] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> np.<span class="bu">max</span>(scores)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_1v1_error(<span class="va">self</span>, ltest, feature):</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># traversal all features</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>        errM <span class="op">=</span> np.zeros((<span class="va">self</span>.n_class, <span class="va">self</span>.n_class))</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="va">self</span>.n_class<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>            lis <span class="op">=</span> ltest[ltest[<span class="st">"label"</span>] <span class="op">==</span> i].index.to_numpy()</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i<span class="op">+</span><span class="dv">1</span>, <span class="va">self</span>.n_class):</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>                ljs <span class="op">=</span> ltest[ltest[<span class="st">"label"</span>] <span class="op">==</span> j].index.to_numpy()</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Data</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>                X <span class="op">=</span> np.concatenate(<span class="op">\</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>                  (feature[lis,:],<span class="op">\</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>                   feature[ljs,:]), axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>                Y <span class="op">=</span> np.concatenate((np.ones(<span class="bu">len</span>(lis))<span class="op">*</span>i,np.ones(<span class="bu">len</span>(ljs))<span class="op">*</span>j))</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Train SVM</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>                y_pred <span class="op">=</span> <span class="va">self</span>.clfs[i][j].predict(X)</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>                errM[i,j] <span class="op">=</span> error(Y, y_pred)</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> errM</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, feature):</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>        predM <span class="op">=</span> np.zeros(( <span class="bu">int</span>(<span class="va">self</span>.n_class <span class="op">*</span> (<span class="va">self</span>.n_class <span class="op">-</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>) , feature.shape[<span class="dv">0</span>]))</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>        c <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="va">self</span>.n_class<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i<span class="op">+</span><span class="dv">1</span>, <span class="va">self</span>.n_class):</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>                predM[c,:] <span class="op">=</span> <span class="va">self</span>.clfs[i][j].predict(feature)</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>                c <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> st.mode(predM, axis<span class="op">=</span><span class="dv">0</span>, keepdims<span class="op">=</span><span class="va">True</span>).mode[<span class="dv">0</span>,:] <span class="co">#majority voting</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> error(ans, pred):</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">len</span>(ans) <span class="op">==</span> <span class="bu">len</span>(pred)</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (ans <span class="op">!=</span> pred).<span class="bu">sum</span>()<span class="op">/</span><span class="bu">float</span>(ans.size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="a" class="level3" data-number="10.0.8">
<h3 data-number="10.0.8" class="anchored" data-anchor-id="a"><span class="header-section-number">10.0.8</span> (a)</h3>
<blockquote class="blockquote">
<p>The convolution layer used and the cross-validated error estimate for each of the six pairwise two-label classifiers</p>
</blockquote>
<p>The cross-validation error of pairwise two-label classifiers given convolution layer is shown in the following table.</p>
</section>
<section id="b" class="level3" data-number="10.0.9">
<h3 data-number="10.0.9" class="anchored" data-anchor-id="b"><span class="header-section-number">10.0.9</span> (b)</h3>
<blockquote class="blockquote">
<p>Separate test error rates on the unused micrographs of each of the four categories, for the pairwise two-label classifiers and the multilabel one-vs-one voting classifier described previously. For the pairwise classifiers use only the test micrographs with the two labels used to train the classifier. For the multilabel classifier, use the test micrographs with the corresponding four labels.</p>
</blockquote>
<p>The empirical test error with unseen dataset is shown in the following table. The pairwise classifier was tested by the labels same as their training set. On the other hand, the multilable classifier is tested with fully four corresonding four labels.</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> df_cv(m, clf, info<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    var1 <span class="op">=</span> []</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    var2 <span class="op">=</span> []</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    cvs <span class="op">=</span> []</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    errs <span class="op">=</span> []</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, m.shape[<span class="dv">0</span>]<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i<span class="op">+</span><span class="dv">1</span>, m.shape[<span class="dv">0</span>]):</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>            var1.append(i)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>            var2.append(j)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>            cvs.append(clf.cv[i,j])</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>            errs.append(m[i,j])</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    infos <span class="op">=</span> [info] <span class="op">*</span> <span class="bu">len</span>(errs)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">"Info"</span>: infos, <span class="st">"Label 1"</span>: var1, <span class="st">"Label 2"</span>: var2, <span class="st">"Test error"</span>: errs,<span class="st">"Cross Validation Error"</span>: cvs})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="pair-wise-classifier" class="level4" data-number="10.0.9.1">
<h4 data-number="10.0.9.1" class="anchored" data-anchor-id="pair-wise-classifier"><span class="header-section-number">10.0.9.1</span> Pair-wise classifier</h4>
<p>The final block performs best in cross validatoin score.</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df_errors <span class="op">=</span> []</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> b <span class="kw">in</span> out_layer_ns:</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    clf1 <span class="op">=</span> One2OneSVM()</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    clf1.train(ltrain, features_train[b])</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    errs <span class="op">=</span> clf1.test_1v1_error(ltest, features_test[b])</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    df_errors.append(df_cv(errs, clf1, b))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>res_error <span class="op">=</span> pd.concat(df_errors)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>res_error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Info</th>
      <th>Label 1</th>
      <th>Label 2</th>
      <th>Test error</th>
      <th>Cross Validation Error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>block1_pool</td>
      <td>0</td>
      <td>1</td>
      <td>0.823529</td>
      <td>0.500</td>
    </tr>
    <tr>
      <th>1</th>
      <td>block1_pool</td>
      <td>0</td>
      <td>2</td>
      <td>0.290155</td>
      <td>0.450</td>
    </tr>
    <tr>
      <th>2</th>
      <td>block1_pool</td>
      <td>0</td>
      <td>3</td>
      <td>0.157895</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>3</th>
      <td>block1_pool</td>
      <td>1</td>
      <td>2</td>
      <td>0.906040</td>
      <td>0.500</td>
    </tr>
    <tr>
      <th>4</th>
      <td>block1_pool</td>
      <td>1</td>
      <td>3</td>
      <td>0.466667</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>5</th>
      <td>block1_pool</td>
      <td>2</td>
      <td>3</td>
      <td>0.071186</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>0</th>
      <td>block2_pool</td>
      <td>0</td>
      <td>1</td>
      <td>0.823529</td>
      <td>0.350</td>
    </tr>
    <tr>
      <th>1</th>
      <td>block2_pool</td>
      <td>0</td>
      <td>2</td>
      <td>0.709845</td>
      <td>0.350</td>
    </tr>
    <tr>
      <th>2</th>
      <td>block2_pool</td>
      <td>0</td>
      <td>3</td>
      <td>0.157895</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>3</th>
      <td>block2_pool</td>
      <td>1</td>
      <td>2</td>
      <td>0.919463</td>
      <td>0.500</td>
    </tr>
    <tr>
      <th>4</th>
      <td>block2_pool</td>
      <td>1</td>
      <td>3</td>
      <td>0.466667</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>5</th>
      <td>block2_pool</td>
      <td>2</td>
      <td>3</td>
      <td>0.071186</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>0</th>
      <td>block3_pool</td>
      <td>0</td>
      <td>1</td>
      <td>0.823529</td>
      <td>0.400</td>
    </tr>
    <tr>
      <th>1</th>
      <td>block3_pool</td>
      <td>0</td>
      <td>2</td>
      <td>0.290155</td>
      <td>0.400</td>
    </tr>
    <tr>
      <th>2</th>
      <td>block3_pool</td>
      <td>0</td>
      <td>3</td>
      <td>0.157895</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>3</th>
      <td>block3_pool</td>
      <td>1</td>
      <td>2</td>
      <td>0.080537</td>
      <td>0.450</td>
    </tr>
    <tr>
      <th>4</th>
      <td>block3_pool</td>
      <td>1</td>
      <td>3</td>
      <td>0.466667</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>5</th>
      <td>block3_pool</td>
      <td>2</td>
      <td>3</td>
      <td>0.071186</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>0</th>
      <td>block4_pool</td>
      <td>0</td>
      <td>1</td>
      <td>0.823529</td>
      <td>0.500</td>
    </tr>
    <tr>
      <th>1</th>
      <td>block4_pool</td>
      <td>0</td>
      <td>2</td>
      <td>0.290155</td>
      <td>0.450</td>
    </tr>
    <tr>
      <th>2</th>
      <td>block4_pool</td>
      <td>0</td>
      <td>3</td>
      <td>0.157895</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>3</th>
      <td>block4_pool</td>
      <td>1</td>
      <td>2</td>
      <td>0.080537</td>
      <td>0.500</td>
    </tr>
    <tr>
      <th>4</th>
      <td>block4_pool</td>
      <td>1</td>
      <td>3</td>
      <td>0.466667</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>5</th>
      <td>block4_pool</td>
      <td>2</td>
      <td>3</td>
      <td>0.071186</td>
      <td>0.375</td>
    </tr>
    <tr>
      <th>0</th>
      <td>block5_pool</td>
      <td>0</td>
      <td>1</td>
      <td>0.073529</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>block5_pool</td>
      <td>0</td>
      <td>2</td>
      <td>0.033679</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>block5_pool</td>
      <td>0</td>
      <td>3</td>
      <td>0.060150</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>block5_pool</td>
      <td>1</td>
      <td>2</td>
      <td>0.000000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>block5_pool</td>
      <td>1</td>
      <td>3</td>
      <td>0.088889</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>block5_pool</td>
      <td>2</td>
      <td>3</td>
      <td>0.061017</td>
      <td>0.125</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="multiple-one-vs-one-classifier" class="level4" data-number="10.0.9.2">
<h4 data-number="10.0.9.2" class="anchored" data-anchor-id="multiple-one-vs-one-classifier"><span class="header-section-number">10.0.9.2</span> Multiple one-vs-one classifier</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiclass one-vs-one</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>dfm_errors <span class="op">=</span> []</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> b <span class="kw">in</span> out_layer_ns:</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    clf <span class="op">=</span> OneVsOneClassifier(svm.SVC(kernel<span class="op">=</span><span class="st">"rbf"</span>, C<span class="op">=</span><span class="fl">1.</span>, gamma<span class="op">=</span><span class="st">"auto"</span>).fit(features_train[b],<span class="op">\</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>          ltrain[<span class="st">"label"</span>].to_numpy(<span class="bu">int</span>)))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    clf.fit(features_train[b],<span class="op">\</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>          ltrain[<span class="st">"label"</span>].to_numpy(<span class="bu">int</span>))</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    y_predm <span class="op">=</span> clf.predict(features_test[b])</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    dfm_errors.append(error(y_predm, ltest[<span class="st">"label"</span>].to_numpy()))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display result</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>res_multi1v1 <span class="op">=</span> pd.DataFrame({<span class="st">"Multiple One-Vs-One Classifier"</span>: out_layer_ns, <span class="st">"Test Error"</span>: dfm_errors})</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>res_multi1v1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Multiple One-Vs-One Classifier</th>
      <th>Test Error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>block1_pool</td>
      <td>0.935035</td>
    </tr>
    <tr>
      <th>1</th>
      <td>block2_pool</td>
      <td>0.944316</td>
    </tr>
    <tr>
      <th>2</th>
      <td>block3_pool</td>
      <td>0.364269</td>
    </tr>
    <tr>
      <th>3</th>
      <td>block4_pool</td>
      <td>0.364269</td>
    </tr>
    <tr>
      <th>4</th>
      <td>block5_pool</td>
      <td>0.071926</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="c" class="level3" data-number="10.0.10">
<h3 data-number="10.0.10" class="anchored" data-anchor-id="c"><span class="header-section-number">10.0.10</span> (c)</h3>
<blockquote class="blockquote">
<p>For the mixed pearlite + spheroidite test micrographs, apply the trained pairwise classifier for pearlite vs.&nbsp;spheroidite and the multilabel voting classifier. Print the predicted labels by these two classifiers side by side (one row for each test micrograph). Comment your results</p>
</blockquote>
<p>The pairwise SVM classifier performs better than Multiclass one-to-one classifier. Because the pairwise SVM is specialized for the binary problem and not be interfered with other classification setting.</p>
<div class="cell" data-execution_count="526">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ltestm <span class="op">=</span> ltest[(ltest[<span class="st">"primary_microconstituent"</span>] <span class="op">==</span> <span class="st">"pearlite"</span>) <span class="op">|\</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>      (ltest[<span class="st">"primary_microconstituent"</span>] <span class="op">==</span> <span class="st">"spheroidite"</span>)]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>feature_m <span class="op">=</span> features_test[<span class="st">"block5_pool"</span>][ltestm.index.to_numpy(), :]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> le.transform([<span class="st">"pearlite"</span>, <span class="st">"spheroidite"</span>])</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>pred_pairs <span class="op">=</span> clf1.clfs[l[<span class="dv">0</span>]][l[<span class="dv">1</span>]].predict(feature_m)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>pred_multi <span class="op">=</span> clf.predict(feature_m)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>res_ps <span class="op">=</span> pd.DataFrame({<span class="st">"Test Label"</span>: le.inverse_transform(ltestm[<span class="st">"label"</span>]),<span class="op">\</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Pairwise (pearlite vs. spheroidite)"</span>: le.inverse_transform(pred_pairs.astype(<span class="bu">int</span>)),<span class="op">\</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Multi-OnevsOne"</span>: le.inverse_transform(pred_multi)})</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(res_ps.to_string())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Test Label Pairwise (pearlite vs. spheroidite)             Multi-OnevsOne
0    spheroidite                         spheroidite                spheroidite
1    spheroidite                         spheroidite                spheroidite
2    spheroidite                         spheroidite                spheroidite
3    spheroidite                         spheroidite                spheroidite
4    spheroidite                         spheroidite                spheroidite
5    spheroidite                         spheroidite                spheroidite
6    spheroidite                         spheroidite                spheroidite
7    spheroidite                         spheroidite                spheroidite
8    spheroidite                         spheroidite                spheroidite
9    spheroidite                         spheroidite                spheroidite
10   spheroidite                         spheroidite                spheroidite
11   spheroidite                         spheroidite                spheroidite
12   spheroidite                         spheroidite                spheroidite
13   spheroidite                         spheroidite                spheroidite
14   spheroidite                         spheroidite                spheroidite
15   spheroidite                         spheroidite                spheroidite
16   spheroidite                         spheroidite                spheroidite
17   spheroidite                         spheroidite                spheroidite
18   spheroidite                         spheroidite                spheroidite
19   spheroidite                         spheroidite                spheroidite
20   spheroidite                         spheroidite                spheroidite
21   spheroidite                         spheroidite                spheroidite
22   spheroidite                         spheroidite                spheroidite
23   spheroidite                         spheroidite  spheroidite+widmanstatten
24   spheroidite                         spheroidite                spheroidite
25   spheroidite                         spheroidite                spheroidite
26   spheroidite                         spheroidite                spheroidite
27   spheroidite                         spheroidite  spheroidite+widmanstatten
28   spheroidite                         spheroidite                spheroidite
29   spheroidite                         spheroidite                spheroidite
30   spheroidite                         spheroidite                spheroidite
31   spheroidite                         spheroidite                spheroidite
32   spheroidite                         spheroidite                spheroidite
33   spheroidite                         spheroidite                spheroidite
34   spheroidite                         spheroidite                spheroidite
35   spheroidite                         spheroidite                spheroidite
36   spheroidite                         spheroidite                spheroidite
37   spheroidite                         spheroidite                spheroidite
38   spheroidite                         spheroidite                spheroidite
39   spheroidite                         spheroidite                spheroidite
40   spheroidite                         spheroidite  spheroidite+widmanstatten
41   spheroidite                         spheroidite                spheroidite
42   spheroidite                         spheroidite                spheroidite
43   spheroidite                         spheroidite                spheroidite
44   spheroidite                         spheroidite                spheroidite
45   spheroidite                         spheroidite                spheroidite
46   spheroidite                         spheroidite                spheroidite
47   spheroidite                         spheroidite                spheroidite
48   spheroidite                         spheroidite                spheroidite
49   spheroidite                         spheroidite                spheroidite
50   spheroidite                         spheroidite                spheroidite
51   spheroidite                         spheroidite                spheroidite
52   spheroidite                         spheroidite                spheroidite
53   spheroidite                         spheroidite                spheroidite
54   spheroidite                         spheroidite                spheroidite
55   spheroidite                         spheroidite                spheroidite
56   spheroidite                         spheroidite                spheroidite
57   spheroidite                         spheroidite                spheroidite
58   spheroidite                         spheroidite                spheroidite
59   spheroidite                         spheroidite                spheroidite
60   spheroidite                         spheroidite                spheroidite
61   spheroidite                         spheroidite                spheroidite
62   spheroidite                         spheroidite                spheroidite
63   spheroidite                         spheroidite                spheroidite
64   spheroidite                         spheroidite                spheroidite
65   spheroidite                         spheroidite                spheroidite
66   spheroidite                         spheroidite                spheroidite
67   spheroidite                         spheroidite                spheroidite
68   spheroidite                         spheroidite                spheroidite
69   spheroidite                         spheroidite                spheroidite
70   spheroidite                         spheroidite                spheroidite
71   spheroidite                         spheroidite                spheroidite
72   spheroidite                         spheroidite                spheroidite
73   spheroidite                         spheroidite                spheroidite
74   spheroidite                         spheroidite                spheroidite
75   spheroidite                         spheroidite                spheroidite
76   spheroidite                         spheroidite                spheroidite
77   spheroidite                         spheroidite                spheroidite
78   spheroidite                         spheroidite                spheroidite
79   spheroidite                         spheroidite                spheroidite
80   spheroidite                         spheroidite                spheroidite
81   spheroidite                         spheroidite                spheroidite
82   spheroidite                         spheroidite                spheroidite
83   spheroidite                         spheroidite                spheroidite
84   spheroidite                         spheroidite                spheroidite
85   spheroidite                         spheroidite                spheroidite
86   spheroidite                         spheroidite                spheroidite
87   spheroidite                         spheroidite                spheroidite
88   spheroidite                         spheroidite                spheroidite
89   spheroidite                         spheroidite                spheroidite
90   spheroidite                         spheroidite  spheroidite+widmanstatten
91   spheroidite                         spheroidite                spheroidite
92   spheroidite                         spheroidite                spheroidite
93   spheroidite                         spheroidite                spheroidite
94   spheroidite                         spheroidite                spheroidite
95   spheroidite                         spheroidite                spheroidite
96   spheroidite                         spheroidite                spheroidite
97   spheroidite                         spheroidite                spheroidite
98   spheroidite                         spheroidite                spheroidite
99   spheroidite                         spheroidite                spheroidite
100  spheroidite                         spheroidite                spheroidite
101  spheroidite                         spheroidite                spheroidite
102  spheroidite                         spheroidite                spheroidite
103  spheroidite                         spheroidite                spheroidite
104  spheroidite                         spheroidite                spheroidite
105  spheroidite                         spheroidite                spheroidite
106  spheroidite                         spheroidite                spheroidite
107  spheroidite                         spheroidite                spheroidite
108  spheroidite                         spheroidite                spheroidite
109  spheroidite                         spheroidite                spheroidite
110  spheroidite                         spheroidite                spheroidite
111  spheroidite                         spheroidite                spheroidite
112  spheroidite                         spheroidite  spheroidite+widmanstatten
113  spheroidite                         spheroidite                spheroidite
114  spheroidite                         spheroidite                spheroidite
115  spheroidite                         spheroidite                spheroidite
116  spheroidite                         spheroidite                spheroidite
117  spheroidite                         spheroidite                spheroidite
118  spheroidite                         spheroidite                spheroidite
119  spheroidite                         spheroidite                spheroidite
120  spheroidite                         spheroidite                spheroidite
121  spheroidite                         spheroidite                spheroidite
122  spheroidite                         spheroidite                spheroidite
123  spheroidite                         spheroidite                spheroidite
124  spheroidite                         spheroidite                spheroidite
125  spheroidite                         spheroidite                spheroidite
126  spheroidite                         spheroidite                spheroidite
127  spheroidite                         spheroidite                spheroidite
128  spheroidite                         spheroidite                spheroidite
129  spheroidite                         spheroidite                spheroidite
130  spheroidite                         spheroidite                spheroidite
131  spheroidite                         spheroidite                spheroidite
132  spheroidite                         spheroidite                spheroidite
133  spheroidite                         spheroidite                spheroidite
134  spheroidite                         spheroidite                spheroidite
135  spheroidite                         spheroidite                spheroidite
136  spheroidite                         spheroidite                spheroidite
137  spheroidite                         spheroidite                spheroidite
138  spheroidite                         spheroidite                spheroidite
139  spheroidite                         spheroidite                spheroidite
140  spheroidite                         spheroidite                spheroidite
141  spheroidite                         spheroidite                spheroidite
142  spheroidite                         spheroidite                spheroidite
143  spheroidite                         spheroidite                spheroidite
144  spheroidite                         spheroidite                spheroidite
145  spheroidite                         spheroidite                spheroidite
146  spheroidite                         spheroidite                spheroidite
147  spheroidite                         spheroidite                spheroidite
148  spheroidite                         spheroidite                spheroidite
149  spheroidite                         spheroidite                spheroidite
150  spheroidite                         spheroidite                spheroidite
151  spheroidite                         spheroidite                spheroidite
152  spheroidite                         spheroidite                spheroidite
153  spheroidite                         spheroidite                spheroidite
154  spheroidite                         spheroidite                spheroidite
155  spheroidite                         spheroidite                spheroidite
156  spheroidite                         spheroidite                spheroidite
157  spheroidite                         spheroidite                spheroidite
158  spheroidite                         spheroidite                spheroidite
159  spheroidite                         spheroidite                spheroidite
160  spheroidite                         spheroidite                spheroidite
161  spheroidite                         spheroidite                spheroidite
162  spheroidite                         spheroidite                spheroidite
163  spheroidite                         spheroidite                spheroidite
164  spheroidite                         spheroidite                spheroidite
165  spheroidite                         spheroidite                spheroidite
166  spheroidite                         spheroidite                    network
167  spheroidite                         spheroidite                spheroidite
168  spheroidite                         spheroidite                spheroidite
169  spheroidite                         spheroidite                spheroidite
170  spheroidite                         spheroidite                spheroidite
171  spheroidite                         spheroidite                spheroidite
172  spheroidite                         spheroidite                spheroidite
173  spheroidite                         spheroidite                spheroidite
174  spheroidite                         spheroidite                spheroidite
175  spheroidite                         spheroidite                spheroidite
176  spheroidite                         spheroidite                spheroidite
177  spheroidite                         spheroidite                spheroidite
178  spheroidite                         spheroidite  spheroidite+widmanstatten
179  spheroidite                         spheroidite                spheroidite
180  spheroidite                         spheroidite                spheroidite
181  spheroidite                         spheroidite                spheroidite
182  spheroidite                         spheroidite                spheroidite
183  spheroidite                         spheroidite                spheroidite
184  spheroidite                         spheroidite                spheroidite
185  spheroidite                         spheroidite                spheroidite
186  spheroidite                         spheroidite                spheroidite
187  spheroidite                         spheroidite                spheroidite
188  spheroidite                         spheroidite                spheroidite
189  spheroidite                         spheroidite                spheroidite
190  spheroidite                         spheroidite  spheroidite+widmanstatten
191  spheroidite                         spheroidite                spheroidite
192  spheroidite                         spheroidite                spheroidite
193  spheroidite                         spheroidite                spheroidite
194  spheroidite                         spheroidite                spheroidite
195  spheroidite                         spheroidite                spheroidite
196  spheroidite                         spheroidite                spheroidite
197  spheroidite                         spheroidite                spheroidite
198  spheroidite                         spheroidite                spheroidite
199  spheroidite                         spheroidite                spheroidite
200  spheroidite                         spheroidite                spheroidite
201  spheroidite                         spheroidite                spheroidite
202  spheroidite                         spheroidite                spheroidite
203  spheroidite                         spheroidite                spheroidite
204  spheroidite                         spheroidite                spheroidite
205  spheroidite                         spheroidite                spheroidite
206  spheroidite                         spheroidite                spheroidite
207  spheroidite                         spheroidite                spheroidite
208  spheroidite                         spheroidite                spheroidite
209  spheroidite                         spheroidite                spheroidite
210  spheroidite                         spheroidite                spheroidite
211  spheroidite                         spheroidite                spheroidite
212  spheroidite                         spheroidite                spheroidite
213  spheroidite                         spheroidite                spheroidite
214  spheroidite                         spheroidite                spheroidite
215  spheroidite                         spheroidite                spheroidite
216  spheroidite                         spheroidite                spheroidite
217  spheroidite                         spheroidite                spheroidite
218  spheroidite                         spheroidite  spheroidite+widmanstatten
219     pearlite                            pearlite                   pearlite
220  spheroidite                         spheroidite                spheroidite
221  spheroidite                         spheroidite                spheroidite
222  spheroidite                         spheroidite                spheroidite
223     pearlite                            pearlite                   pearlite
224     pearlite                            pearlite                   pearlite
225  spheroidite                         spheroidite                spheroidite
226  spheroidite                         spheroidite                spheroidite
227     pearlite                            pearlite                   pearlite
228  spheroidite                         spheroidite                spheroidite
229  spheroidite                         spheroidite                spheroidite
230  spheroidite                         spheroidite                spheroidite
231  spheroidite                         spheroidite                spheroidite
232  spheroidite                         spheroidite                spheroidite
233  spheroidite                         spheroidite                    network
234  spheroidite                         spheroidite                spheroidite
235  spheroidite                         spheroidite  spheroidite+widmanstatten
236  spheroidite                         spheroidite                spheroidite
237  spheroidite                         spheroidite                spheroidite
238     pearlite                            pearlite                   pearlite
239     pearlite                            pearlite                   pearlite
240  spheroidite                         spheroidite                spheroidite
241     pearlite                            pearlite                   pearlite
242     pearlite                            pearlite                   pearlite
243  spheroidite                         spheroidite                spheroidite
244  spheroidite                         spheroidite                spheroidite
245  spheroidite                         spheroidite                spheroidite
246  spheroidite                         spheroidite                spheroidite
247  spheroidite                         spheroidite                spheroidite
248  spheroidite                         spheroidite                spheroidite
249  spheroidite                         spheroidite                spheroidite
250  spheroidite                         spheroidite                spheroidite
251  spheroidite                         spheroidite                spheroidite
252     pearlite                            pearlite                   pearlite
253     pearlite                            pearlite                   pearlite
254     pearlite                            pearlite                   pearlite
255     pearlite                            pearlite                   pearlite
256     pearlite                            pearlite                   pearlite
257  spheroidite                         spheroidite                spheroidite
258  spheroidite                         spheroidite                spheroidite
259  spheroidite                         spheroidite                spheroidite
260  spheroidite                         spheroidite                spheroidite
261  spheroidite                         spheroidite                spheroidite
262  spheroidite                         spheroidite                spheroidite
263  spheroidite                         spheroidite                spheroidite
264  spheroidite                         spheroidite                spheroidite
265  spheroidite                         spheroidite                spheroidite
266  spheroidite                         spheroidite                spheroidite
267     pearlite                            pearlite                   pearlite
268     pearlite                            pearlite                   pearlite
269  spheroidite                         spheroidite                spheroidite
270     pearlite                            pearlite                   pearlite
271  spheroidite                         spheroidite                spheroidite
272  spheroidite                         spheroidite                spheroidite
273  spheroidite                         spheroidite                spheroidite
274     pearlite                            pearlite                   pearlite
275     pearlite                            pearlite                   pearlite
276  spheroidite                         spheroidite                spheroidite
277     pearlite                            pearlite                   pearlite
278  spheroidite                         spheroidite                spheroidite
279  spheroidite                         spheroidite                spheroidite
280  spheroidite                         spheroidite                spheroidite
281  spheroidite                         spheroidite                spheroidite
282  spheroidite                         spheroidite                spheroidite
283  spheroidite                         spheroidite                spheroidite
284  spheroidite                         spheroidite                spheroidite
285  spheroidite                         spheroidite                spheroidite
286     pearlite                            pearlite                   pearlite
287     pearlite                            pearlite                   pearlite
288  spheroidite                         spheroidite                spheroidite
289  spheroidite                         spheroidite                spheroidite
290  spheroidite                         spheroidite                spheroidite
291  spheroidite                         spheroidite                spheroidite
292  spheroidite                         spheroidite                spheroidite
293     pearlite                            pearlite                   pearlite
294  spheroidite                         spheroidite                spheroidite
295  spheroidite                         spheroidite                spheroidite
296     pearlite                            pearlite                   pearlite
297     pearlite                            pearlite                   pearlite</code></pre>
</div>
</div>
</section>
<section id="d" class="level3" data-number="10.0.11">
<h3 data-number="10.0.11" class="anchored" data-anchor-id="d"><span class="header-section-number">10.0.11</span> (d)</h3>
<blockquote class="blockquote">
<p>Now apply the multilabel classifier on the pearlite + Widmanst¨atten and martensite micrographs and print the predicted labels. Compare to the results in part (c)</p>
</blockquote>
<p>There is no specific relation for these unseen datasets. The prediction can not extrapolate, and (c) has preferred prediction accuracy and consistency.</p>
<div class="cell" data-execution_count="519">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_micro2 <span class="op">=</span> df_micro2[(df_micro2[<span class="st">"primary_microconstituent"</span>] <span class="op">==</span> <span class="st">"pearlite+widmanstatten"</span>) <span class="op">|\</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>(df_micro2[<span class="st">"primary_microconstituent"</span>] <span class="op">==</span> <span class="st">"martensite"</span>)]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Encode labels</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>le2 <span class="op">=</span> preprocessing.LabelEncoder()</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>le2.fit(df_micro2[<span class="st">"primary_microconstituent"</span>].unique())</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(le2.classes_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="519">
<pre><code>['martensite', 'pearlite+widmanstatten']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="520">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dlabel2 <span class="op">=</span> le2.transform(df_micro2[<span class="st">"primary_microconstituent"</span>])</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df_micro2.insert(<span class="dv">2</span>, <span class="st">"label"</span>, dlabel2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="521">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_micro2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="521">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>path</th>
      <th>primary_microconstituent</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph20.tif</td>
      <td>martensite</td>
      <td>0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph41.tif</td>
      <td>martensite</td>
      <td>0</td>
    </tr>
    <tr>
      <th>31</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph44.tif</td>
      <td>martensite</td>
      <td>0</td>
    </tr>
    <tr>
      <th>63</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph99.tif</td>
      <td>martensite</td>
      <td>0</td>
    </tr>
    <tr>
      <th>71</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph114.tif</td>
      <td>martensite</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>892</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1599.tif</td>
      <td>martensite</td>
      <td>0</td>
    </tr>
    <tr>
      <th>936</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1684.tif</td>
      <td>pearlite+widmanstatten</td>
      <td>1</td>
    </tr>
    <tr>
      <th>942</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1697.tif</td>
      <td>martensite</td>
      <td>0</td>
    </tr>
    <tr>
      <th>944</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1700.tif</td>
      <td>martensite</td>
      <td>0</td>
    </tr>
    <tr>
      <th>956</th>
      <td>data/CMU-UHCS_Dataset/images/micrograph1723.tif</td>
      <td>martensite</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>63 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="536">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature extraction with VGG16</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(os.path.join(dpath, <span class="st">"feature_test2.pkl"</span>)) <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    fs_test2 <span class="op">=</span> np.zeros((df_micro2.shape[<span class="dv">0</span>], out_shapes[<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> <span class="st">"block5_pool"</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j, ph <span class="kw">in</span> tqdm(<span class="bu">enumerate</span>(df_micro2[<span class="st">"path"</span>])):</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> load_image(ph)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        xb <span class="op">=</span> extmodel[m].predict(x, verbose <span class="op">=</span> <span class="dv">0</span>) <span class="co"># silence output</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        F <span class="op">=</span> np.mean(xb,axis<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Save features</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        fs_test2[j, :] <span class="op">=</span> F</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save data</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Create new files</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    fs_test2_p <span class="op">=</span> <span class="bu">open</span>(os.path.join(dpath, <span class="st">"feature_test2.pkl"</span>), <span class="st">"wb"</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Write</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    pickle.dump(fs_test2, fs_test2_p)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Close files</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    fs_test2_p.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="540">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load data</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>fs_test2_p  <span class="op">=</span> <span class="bu">open</span>(os.path.join(dpath, <span class="st">"feature_test2.pkl"</span>), <span class="st">"rb"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>fs_test2 <span class="op">=</span> pickle.load(fs_test2_p) <span class="co"># train feature</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>fs_test2_p .close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="541">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pred_multi2 <span class="op">=</span> clf.predict(fs_test2)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>res_ps2 <span class="op">=</span> pd.DataFrame({<span class="st">"Test Label"</span>: le2.inverse_transform(df_micro2[<span class="st">"label"</span>]),<span class="op">\</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Multi-OnevsOne"</span>: le.inverse_transform(pred_multi2)})</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(res_ps2.to_string())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Test Label             Multi-OnevsOne
0               martensite                spheroidite
1               martensite                    network
2               martensite                   pearlite
3               martensite                spheroidite
4               martensite                spheroidite
5               martensite                    network
6               martensite                spheroidite
7   pearlite+widmanstatten                   pearlite
8               martensite                   pearlite
9               martensite                spheroidite
10              martensite                spheroidite
11  pearlite+widmanstatten                   pearlite
12              martensite                   pearlite
13  pearlite+widmanstatten                   pearlite
14              martensite                   pearlite
15  pearlite+widmanstatten                spheroidite
16  pearlite+widmanstatten  spheroidite+widmanstatten
17  pearlite+widmanstatten                   pearlite
18              martensite                   pearlite
19  pearlite+widmanstatten                spheroidite
20  pearlite+widmanstatten                   pearlite
21  pearlite+widmanstatten                spheroidite
22  pearlite+widmanstatten                spheroidite
23  pearlite+widmanstatten                   pearlite
24  pearlite+widmanstatten                   pearlite
25              martensite                   pearlite
26              martensite                spheroidite
27              martensite                   pearlite
28              martensite                spheroidite
29              martensite                   pearlite
30              martensite                spheroidite
31              martensite                   pearlite
32  pearlite+widmanstatten                   pearlite
33              martensite                   pearlite
34              martensite                spheroidite
35  pearlite+widmanstatten                spheroidite
36              martensite                spheroidite
37  pearlite+widmanstatten                spheroidite
38  pearlite+widmanstatten                   pearlite
39  pearlite+widmanstatten                   pearlite
40              martensite                   pearlite
41              martensite                spheroidite
42  pearlite+widmanstatten                   pearlite
43  pearlite+widmanstatten                spheroidite
44  pearlite+widmanstatten  spheroidite+widmanstatten
45  pearlite+widmanstatten                   pearlite
46  pearlite+widmanstatten                   pearlite
47              martensite                   pearlite
48  pearlite+widmanstatten                   pearlite
49              martensite                   pearlite
50  pearlite+widmanstatten  spheroidite+widmanstatten
51  pearlite+widmanstatten                   pearlite
52              martensite                   pearlite
53  pearlite+widmanstatten                spheroidite
54              martensite                spheroidite
55              martensite                spheroidite
56              martensite                   pearlite
57              martensite                    network
58              martensite                spheroidite
59  pearlite+widmanstatten                   pearlite
60              martensite                spheroidite
61              martensite                   pearlite
62              martensite                spheroidite</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../hw/hw4.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Homework 4</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../hw/hw5.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Homework 5</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>